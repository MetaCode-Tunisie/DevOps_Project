pipeline {

    agent any
     

    stages {
    stage("Chekout Git"){
            steps {
                echo "Pulling"
            }
        }
    stage("Build") {
             steps {
                sh "mvn clean package -DskipTests"
            }
        }
        /*stage('Publish to Nexus') {
             steps {
                sh "mvn deploy -DskipTests"
        
                }
            }
          stage('MVN SONARQUBE') {
            steps {
                sh 'mvn sonar:sonar -Dsonar.login=admin -Dsonar.password=sonar -Dmaven.test.skip=true';

            }
        }*/
        
        stage('Build Docker Image') {
            steps {
                script {
                    def customImageName = "khalilimage"
                    sh "docker build -t $customImageName ."
                }
            }
        }
       stage('Push Docker Image') {
    steps {
        script {
            def dockerUsername = 'charguikhalil'
            def dockerPassword = 'khalilchargui'
            sh "docker login -u $dockerUsername -p $dockerPassword"
            
                sh 'docker tag khalilimage charguikhalil/khalilimage'
                sh 'docker push charguikhalil/khalilimage'
            
        }
    }
}
       stage('Verify Docker Compose Installation') {
            steps {
                sh 'docker compose version'
                    }
}
stage('Docker Compose') {
            steps {
                 
               
                sh 'docker compose up -d'
                  sh 'docker compose down'
                  sh 'docker compose up -d'
                  
            }
        }
stage('Docker debug') {
            steps {
                 
               
                sh 'docker stop mysqldb'
                  sh 'docker volume rm db'
                  sh 'docker-compose up -d mysqldb'
                  
            }
        }

        stage('check Docker Compose') {
            steps {
                script {
                        sh 'docker compose ps'
                    }
                }
            }
        /*stage('Tests') {
                steps {
                    sh 'mvn test'
                	}
                }*/

        
}
}
